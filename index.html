<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>سرور رایگان V2Ray</title>
<style>
:root{
  --bg:#071022;
  --card:#0b1220;
  --muted:rgba(230,238,248,0.65);
  --accent-1:#0ea5a4;
  --accent-2:#1f6feb;
  --accent-3:#6f42c1;
  --accent-4:#2d9c6b;
  --btn:#67c7b9;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family: Vazirmatn, Tahoma, Arial, sans-serif;
  background: linear-gradient(180deg,#041022 0%, var(--bg) 100%);
  color: #eaf2ff;
  padding:22px;
  text-align: center;
}
.header {
  margin-bottom:18px;
}
h1{
  font-size:30px;
  margin-bottom:6px;
  font-weight:800;
}
.subtitle{
  color:var(--muted);
  margin-bottom:14px;
}

/* card / table */
.card{
  max-width:920px;
  margin:0 auto;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:12px;
  padding:16px;
  border:1px solid rgba(255,255,255,0.03);
  box-shadow:0 10px 30px rgba(0,0,0,0.6);
}
.table-head{
  display:grid;
  grid-template-columns:90px 1fr 180px 120px;
  gap:8px;
  align-items:center;
  padding:10px;
  border-radius:8px;
  background:linear-gradient(90deg,var(--accent-2),var(--accent-3));
  color:#fff;
  font-weight:700;
}
.table-body{
  margin-top:12px;
  max-height:56vh;
  overflow:auto;
}
.row{
  display:grid;
  grid-template-columns:90px 1fr 180px 120px;
  gap:8px;
  align-items:center;
  padding:12px;
  border-bottom:1px solid rgba(255,255,255,0.03);
}
.row:nth-child(odd){ background: rgba(255,255,255,0.01); }
.row:nth-child(even){ background: rgba(255,255,255,0.00); }

/* copy button */
.copy-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#012;
  border-radius:10px;
  padding:10px 12px;
  cursor:pointer;
  font-weight:800;
  text-decoration:none;
  user-select:none;
  transition:transform .12s;
}
.copy-btn:active{ transform:translateY(2px); }

/* status */
.status-wrap{display:flex;align-items:center;gap:12px;justify-content:center}
.status-text{font-weight:700}
.indicator{
  width:18px;height:18px;border-radius:50%;display:inline-block;
  box-shadow:0 6px 18px rgba(0,0,0,0.35);
}
.online{ background:linear-gradient(90deg,#34d399,#86efac); animation: pulse 1.3s infinite; }
.offline{ background:linear-gradient(90deg,#ff7b7b,#ffb4b4); animation: wobble 1.1s infinite; }
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.12)}100%{transform:scale(1)}}
@keyframes wobble{0%{transform:translateY(0)}50%{transform:translateY(-4px) rotate(-6deg)}100%{transform:translateY(0)}}

/* name cell */
.nameCell{font-weight:700;text-align:left;direction:ltr;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* footer box for ids */
.info-box{
  margin-top:18px;
  display:flex;
  gap:12px;
  justify-content:center;
  align-items:center;
  flex-wrap:wrap;
}
.id-box{
  background:linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#012;padding:10px 14px;border-radius:12px;font-weight:800;text-decoration:none;
}
.small-muted{color:var(--muted);font-size:13px;margin-top:8px}

/* logo */
.logo-wrap{margin-top:18px}
.logo-img{max-width:220px;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,0.6)}

/* responsive */
@media (max-width:720px){
  .table-head, .row{grid-template-columns:60px 1fr 140px 90px}
  .logo-img{max-width:160px}
  h1{font-size:24px}
}
</style>
</head>
<body>

  <div class="header">
    <h1>🚀 سرور رایگان V2Ray 🚀</h1>
    <div class="subtitle">سرور رایگان V2ray</div>
  </div>

  <div class="card" role="region" aria-label="سرورها">
    <div class="table-head"><div>شماره</div><div>نام سرور</div><div>وضعیت</div><div>لینک</div></div>

    <div class="table-body" id="tableBody" aria-live="polite">
      <!-- rows injected here -->
    </div>

    <div class="info-box">
      <div class="small-muted">ساخته شده توسط</div>
      <a class="id-box" href="https://t.me/the_warrior99" target="_blank">@the_warrior99</a>
      <div class="small-muted">| کانال تلگرام</div>
      <a class="id-box" href="https://t.me/DarkHub_VPN" target="_blank">@DarkHub_VPN</a>
    </div>
    <div class="logo-wrap">
      <!-- لوگو را اینجا بگذار (فایل logo.png کنار index.html) -->
      <img src="logo.png" alt="DarkHub VPN Logo" class="logo-img" />
    </div>
    <div class="small-muted">© ساخته شده با ❤️</div>
  </div>

<script>
  // ====== تنظیمات ======
  const sheetID = "1ByvYuNP-DZojlxCiqsr0i18j5OXBsIPPfTQDp1qjiQY"; // لینک شیت تو
  const sheetName = "Sheet2"; // اگر اسم شیت تغییر کرد عوض کن
  const gvizUrl = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
  // ======================

  // یک تابع کمکی برای تشخیص وضعیت
  function parseStatus(s){
    if(!s) return 'unknown';
    const t = String(s).trim().toLowerCase();
    if(t.includes('on') || t.includes('متصل') || t.includes('online') || t === '1') return 'online';
    if(t.includes('off') || t.includes('قطع') || t.includes('offline') || t === '0') return 'offline';
    return 'unknown';
  }

  // خواندن از Google Sheets (GViz)
  fetch(gvizUrl).then(r=>r.text()).then(txt=>{
    // google gviz returns something like: /*O_o*/google.visualization.Query.setResponse({...});
    const jsonText = txt.substr(txt.indexOf('{'));
    const json = JSON.parse(jsonText.slice(0, jsonText.lastIndexOf(')')));
    const rows = json.table.rows || [];
    const body = document.getElementById('tableBody');
    body.innerHTML = '';

    // فرض: ردیف اول شیت header است -> از ردیف 2 شروع می‌کنیم
    for(let i=1;i<rows.length;i++){
      const row = rows[i];
      // ستون‌ها بر اساس صف A,B,C,D => c[0]=A (Link), c[1]=B(Status), c[2]=C(Name), c[3]=D(Number)
      const linkCell = row.c[0] && row.c[0].v ? row.c[0].v : '';
      const statusRaw = row.c[1] && row.c[1].v ? row.c[1].v : '';
      const nameCell = row.c[2] && row.c[2].v ? row.c[2].v : '';
      const numberCell = row.c[3] && row.c[3].v ? row.c[3].v : (i); // fallback to index

      const status = parseStatus(statusRaw);

      const div = document.createElement('div');
      div.className = 'row';

      // شماره
      const num = document.createElement('div');
      num.textContent = numberCell;
      num.style.opacity = 0.95;

      // نام سرور
      const name = document.createElement('div');
      name.className = 'nameCell';
      name.textContent = nameCell || linkCell || ('server ' + numberCell);

      // وضعیت
      const statusWrap = document.createElement('div');
      statusWrap.className = 'status-wrap';
      const ind = document.createElement('span');
      ind.className = 'indicator ' + (status === 'online' ? 'online' : status === 'offline' ? 'offline' : '');
      const txt = document.createElement('span');
      txt.className = 'status-text';
      // متن فارسی آنلاین/آفلاین
      if(status === 'online'){ txt.textContent = 'آنلاین'; }
      else if(status === 'offline'){ txt.textContent = 'آفلاین'; }
      else { txt.textContent = (statusRaw || '—'); }
      statusWrap.appendChild(ind);
      statusWrap.appendChild(txt);

      // لینک + دکمه کپی
      const linkBox = document.createElement('div');
      linkBox.style.display = 'flex';
      linkBox.style.justifyContent = 'center';
      linkBox.style.gap = '8px';
      linkBox.style.alignItems = 'center';

      const copyBtn = document.createElement('button');
      copyBtn.className = 'copy-btn';
      copyBtn.textContent = 'کپی';
      copyBtn.title = 'کپی لینک سرور';
      copyBtn.onclick = ()=> {
        // اگر لینک خالی بود، پیام بده
        if(!linkCell){ navigator.clipboard.writeText('').then(()=>alert('لینک موجود نیست.')); return; }
        navigator.clipboard.writeText(linkCell).then(()=>{
          copyBtn.textContent = 'کپی شد';
          setTimeout(()=>copyBtn.textContent='کپی',1200);
        }).catch(()=>{ alert('کپی انجام نشد — مرورگر اجازه نداد'); });
      };

      // لینک بازشونده
      const a = document.createElement('a');
      a.href = linkCell || '#';
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.style.color = '#9fe7ff';
      a.style.fontWeight = '700';
      a.textContent = linkCell ? 'باز کردن' : '—';

      linkBox.appendChild(copyBtn);
      linkBox.appendChild(a);

      // افزودن به ردیف
      div.appendChild(num);
      div.appendChild(name);
      div.appendChild(statusWrap);
      div.appendChild(linkBox);

      body.appendChild(div);
    }

    // اگر فقط header و بدون داده بود یک پیام نشان بده
    if(rows.length <= 1){
      body.innerHTML = '<div style="padding:18px;color:var(--muted)">هیچ سروری پیدا نشد — سطرهای شیت را چک کن.</div>';
    }
  }).catch(err=>{
    document.getElementById('tableBody').innerHTML = '<div style="padding:18px;color:var(--muted)">خطا در بارگذاری شیت — مطمئن شو شیت عمومی شده و sheetName درست است.</div>';
    console.error(err);
  });
</script>
</body>
</html>
